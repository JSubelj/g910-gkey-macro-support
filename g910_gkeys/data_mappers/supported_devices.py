from dataclasses import dataclass, field


@dataclass(frozen=True)
class DeviceEventInterface:
    macroKeys: dict  # dict[bytes, str]
    memoryKeys: dict  # dict[bytes, str]
    memoryKeysLEDs = dict()  # dict[str, bytes]
    mediaKeys: dict  # dict[bytes, str] | only in use when in libUSB mode (kernel driver unloaded)
    releaseEvents: dict  # dict[str, bytes]

    # Following is sent to disable the default G keys mapping
    disableGKeys = list()  # list[bytes]
    disableGKeysResponse = list()  # list[bytes]
    # enable the g-key to f-key mapping
    enableGKeys = list()  # list[bytes]
    enableGKeysResponse = list()  # list[bytes]


@dataclass(frozen=True)
class LogitechG910EventInterface(DeviceEventInterface):
    macroKeys = {
        b'\x11\xff\x08\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MACRO_1",
        b'\x11\xff\x08\x00\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MACRO_2",
        b'\x11\xff\x08\x00\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MACRO_3",
        b'\x11\xff\x08\x00\x08\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MACRO_4",
        b'\x11\xff\x08\x00\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MACRO_5",
        b'\x11\xff\x08\x00\x20\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MACRO_6",
        b'\x11\xff\x08\x00\x40\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MACRO_7",
        b'\x11\xff\x08\x00\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MACRO_8",
        b'\x11\xff\x08\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MACRO_9"
    }

    memoryKeys = {
        b'\x11\xff\x09\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MEMORY_1",
        b'\x11\xff\x09\x00\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MEMORY_2",
        b'\x11\xff\x09\x00\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MEMORY_3",
        b'\x11\xff\x0a\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MEMORY_RECORD"
    }

    memoryKeysLEDs = {
        "MEMORY_1": b'\x11\xff\x09\x1b\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',
        "MEMORY_2": b'\x11\xff\x09\x1b\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',
        "MEMORY_3": b'\x11\xff\x09\x1b\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',
        "MEMORY_RECORD": [
            b'\x11\xff\x0a\x0e\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',
            b'\x11\xff\x0a\x0e\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',
        ]
    }

    mediaKeys = {
        b'\x02\x08': "KEY_PLAYPAUSE",
        b'\x02\x04': "KEY_STOP",
        b'\x02\x02': "KEY_PREVIOUS",
        b'\x02\x01': "KEY_NEXT",
        b'\x02\x40': "KEY_MUTE",
        b'\x02\x10': "KEY_VOLUMEUP",
        b'\x02\x20': "KEY_VOLUMEDOWN"
    }

    releaseEvents = {
        b'\x11\xff\x08\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': 'MACRO_RELEASE',
        b'\x02\x00': 'MEDIA_RELEASE',
        b'\x11\xff\x09\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': 'MEMORY_RELEASE',
        b'\x11\xff\x0a\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': 'MEMORY_RECORD_RELEASE'
    }

    disableGKeys = [
        b'\x11\xff\x08\x2e\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
    ]

    disableGKeysResponse = [
        b'\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',
        b'\x02\x00',  # media key release
        disableGKeys[0],
        b'\x11\xff\x08\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',  # macro key release
        b'\x11\xff\x09\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',  # memory key release
        b'\x11\xff\x0a\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'   # memory record release
    ]

    enableGKeys = [b'\x11\xff\x08\x2e\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00']

    enableGKeysResponse = [
        b'\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',
        b'\x02\x00',  # media key release
        disableGKeys[0],
        b'\x11\xff\x08\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',  # macro key release
        b'\x11\xff\x09\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',  # memory key release
        b'\x11\xff\x0a\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'   # memory record release
    ]


@dataclass(frozen=True)
class LogitechG815EventInterface(DeviceEventInterface):
    macroKeys = {
        b'\x11\xff\x0a\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MACRO_1",
        b'\x11\xff\x0a\x00\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MACRO_2",
        b'\x11\xff\x0a\x00\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MACRO_3",
        b'\x11\xff\x0a\x00\x08\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MACRO_4",
        b'\x11\xff\x0a\x00\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MACRO_5",
        b'\x11\xff\x0c\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MEMORY_RECORD"
    }

    memoryKeys = {
        b'\x11\xff\x0b\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MEMORY_1",
        b'\x11\xff\x0b\x00\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MEMORY_2",
        b'\x11\xff\x0b\x00\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MEMORY_3"
    }

    memoryKeysLEDs = {
        "MEMORY_1": b'\x11\xff\x0b\x1a\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',  # M1 LED
        "MEMORY_2": b'\x11\xff\x0b\x1a\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',  # M2 LED
        "MEMORY_3": b'\x11\xff\x0b\x1a\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'   # M3 LED
    }

    mediaKeys = {
        b'\x03\x08': "KEY_PLAYPAUSE",
        b'\x03\x04': "KEY_STOP",
        b'\x03\x02': "KEY_PREVIOUS",
        b'\x03\x01': "KEY_NEXT",
        b'\x03\x10': "KEY_VOLUMEUP",
        b'\x03\x20': "KEY_VOLUMEDOWN",
        b'\x03\x40': "KEY_MUTE"
    }

    releaseEvents = {
        'KEY_G': b'\x11\xff\x0a\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',      # G release
        'KEY_MEDIA': b'\x03\x00',  # media key release
        'KEY_M': b'\x11\xff\x0b\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',    # M release
        'KEY_MR': b'\x11\xff\x0c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'     # MR release
    }

    disableGKeys = [
        # switch from keyboard memory mode to client mode - disables everything but the "normal" keys,
        # so we need to enable it again
        b'\x11\xff\x11\x1a\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',
        # enable G-keys
        b'\x11\xff\x0a\x2a\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',
        # enable LED manual control (not 100% sure but without this package the following
        # two packages will not do anything)
        b'\x11\xff\x0f\x5a\x01\x03\x07\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',
        # enable GLogo light
        b'\x11\xff\x0f\x1a\x00\x02\x00\x00\x00\x00\x00\x08\x34\x64\x00\x00\x01\x00\x00\x00',
        # enable default background light
        b'\x11\xff\x0f\x1a\x01\x04\x00\x00\x00\x00\x00\x00\x34\x01\x64\x08\x01\x00\x00\x00'
    ]


@dataclass(frozen=True)
class LogitechG915EventInterface(LogitechG815EventInterface):
    macroKeys = {
        b'\x02\x01\x00\x00\x00\x00\x00\x00\x00': "MACRO_1",
        b'\x02\x02\x00\x00\x00\x00\x00\x00\x00': "MACRO_2",
        b'\x02\x04\x00\x00\x00\x00\x00\x00\x00': "MACRO_3",
        b'\x02\x08\x00\x00\x00\x00\x00\x00\x00': "MACRO_4",
        b'\x02\x10\x00\x00\x00\x00\x00\x00\x00': "MACRO_5",
        b'\x11\x01\x0c\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MEMORY_RECORD"
    }

    memoryKeys = {
        b'\x11\x01\x0b\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MEMORY_1",
        b'\x11\x01\x0b\x00\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MEMORY_2",
        b'\x11\x01\x0b\x00\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00': "MEMORY_3"
    }

    memoryKeysLEDs = {
        "MEMORY_1": b'\x11\x01\x0b\x1a\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',  # M1 LED
        "MEMORY_2": b'\x11\x01\x0b\x1a\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',  # M2 LED
        "MEMORY_3": b'\x11\x01\x0b\x1a\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'   # M3 LED
    }

    releaseEvents = {
        'KEY_G': b'\x02\x00\x00\x00\x00\x00\x00\x00\x00'  # G release
    }

    disableGKeys = [
        b'\x11\x01\x11\x1a\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',
        b'\x11\x01\x0a\x2a\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',
        b'\x11\x01\x0f\x5a\x01\x03\x07\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',
        b'\x11\x01\x0f\x1a\x00\x02\x00\x00\x00\x00\x00\x08\x34\x64\x00\x00\x01\x00\x00\x00',
        b'\x11\x01\x0f\x1a\x01\x04\x00\x00\x00\x00\x00\x00\x34\x01\x64\x08\x01\x00\x00\x00'
    ]


@dataclass(frozen=True)
class LogitechG710EventInterface(DeviceEventInterface):
    macroKeys = {
        b'\x03\x01\x00\x00': "MACRO_1",
        b'\x03\x02\x00\x00': "MACRO_2",
        b'\x03\x04\x00\x00': "MACRO_3",
        b'\x03\x08\x00\x00': "MACRO_4",
        b'\x03\x10\x00\x00': "MACRO_5",
        b'\x03\x20\x00\x00': "MACRO_6",
        b'\x03\x00\x80\x00': "MEMORY_RECORD"
    }

    memoryKeys = {
        b'\x03\x00\x10\x00': "MEMORY_1",
        b'\x03\x00\x20\x00': "MEMORY_2",
        b'\x03\x00\x40\x00': "MEMORY_3"
    }

    memoryKeysLEDs = {
        "MEMORY_1": b'\x06\x10',  # M1 LED
        "MEMORY_2": b'\x06\x20',  # M2 LED
        "MEMORY_3": b'\x06\x40'   # M3 LED
    }

    mediaKeys = {
        b'\x02\x08': "KEY_PLAYPAUSE",
        b'\x02\x04': "KEY_STOP",
        b'\x02\x02': "KEY_PREVIOUS",
        b'\x02\x01': "KEY_NEXT",
        b'\x02\x40': "KEY_MUTE",
        b'\x02\x10': "KEY_VOLUMEUP",
        b'\x02\x20': "KEY_VOLUMEDOWN"
    }

    releaseEvents = {
        'KEY_G': b'\x03\x00\x00\x00',    # G release
        'KEY_MEDIA': b'\x02\x00',            # media key release
        'KEY_M': b'\x03\x00\x00\x00',    # M release
        'KEY_MR': b'\x03\x00\x00\x00'     # MR release
    }

    disableGKeys = [b'\x09\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00']


@dataclass(frozen=True)
class LogitechG510EventInterface(DeviceEventInterface):
    macroKeys = {
        b'\x03\x01\x00\x00\x00': "MACRO_1",
        b'\x03\x02\x00\x00\x00': "MACRO_2",
        b'\x03\x04\x00\x00\x00': "MACRO_3",
        b'\x03\x08\x00\x00\x00': "MACRO_4",
        b'\x03\x10\x00\x00\x00': "MACRO_5",
        b'\x03\x20\x00\x00\x00': "MACRO_6",
        b'\x03\x40\x00\x00\x00': "MACRO_7",
        b'\x03\x80\x00\x00\x00': "MACRO_8",
        b'\x03\x00\x01\x00\x00': "MACRO_9",
        b'\x03\x00\x02\x00\x00': "MACRO_10",
        b'\x03\x00\x04\x00\x00': "MACRO_11",
        b'\x03\x00\x08\x00\x00': "MACRO_12",
        b'\x03\x00\x10\x00\x00': "MACRO_13",
        b'\x03\x00\x20\x00\x00': "MACRO_14",
        b'\x03\x00\x40\x00\x00': "MACRO_15",
        b'\x03\x00\x80\x00\x00': "MACRO_16",
        b'\x03\x00\x00\x01\x00': "MACRO_17",
        b'\x03\x00\x00\x02\x00': "MACRO_18",
        b'\x03\x00\x00\x80\x00': "MEMORY_RECORD"
    }

    memoryKeys = {
        b'\x03\x00\x00\x10\x00': "MEMORY_1",
        b'\x03\x00\x00\x20\x00': "MEMORY_2",
        b'\x03\x00\x00\x40\x00': "MEMORY_3"
    }

    mediaKeys = {
        b'\x02\x08': "KEY_PLAYPAUSE",
        b'\x02\x04': "KEY_STOP",
        b'\x02\x02': "KEY_PREVIOUS",
        b'\x02\x01': "KEY_NEXT",
        b'\x02\x10': "KEY_MUTE",  # not 100% sure about those last 3
        b'\x02\x20': "KEY_VOLUMEDOWN",
        b'\x02\x40': "KEY_VOLUMEUP"
    }

    releaseEvents = {
        'KEY_G': b'\x03\x00\x00\x00\x00',   # M and G release
        'KEY_MEDIA': b'\x02\x00'            # media key release
    }

    disableGKeys = [
        b'\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',
        b'\x07\x03\x00',
        b'\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',
    ]


@dataclass(frozen=True)
class KeyboardInterface:

    deviceName: str

    usbVendor: int
    usbProduct: int
    usbConfiguration: int
    usbInterface: tuple  # tuple[int, int] | (index of interface, index of alternate setting)
    usbEndpoint: int

    numMacroKeys: int
    numMemoryKeys: int  # number of memory / profile keys

    events: DeviceEventInterface

    disableGKeysInterface: int
    disableGKeysUseWrite: bool = field(default=True)


@dataclass(frozen=True)
class LogitechG910OrionSpectrum(KeyboardInterface):

    deviceName = "Logitech G910 Orion Spectrum"

    usbVendor = 0x046d
    usbProduct = 0xc335
    usbConfiguration = 0
    usbInterface = (1, 0)
    usbEndpoint = 0

    numMacroKeys = 9
    numMemoryKeys = 3

    disableGKeysInterface = 1

    events = LogitechG910EventInterface


@dataclass(frozen=True)
class LogitechG910OrionSpark(LogitechG910OrionSpectrum):
    deviceName = "Logitech G910 Orion Spark"
    usbProduct = 0xc32b
    disableGKeysInterface = 0


@dataclass(frozen=True)
class LogitechG710p(KeyboardInterface):
    deviceName = "Logitech G710+"

    usbVendor = 0x046d
    usbProduct = 0xc24d
    usbConfiguration = 0
    usbInterface = (1, 0)
    usbEndpoint = 0

    numMacroKeys = 6
    numMemoryKeys = 3

    disableGKeysInterface = 1
    disableGKeysUseWrite = False

    events = LogitechG710EventInterface


@dataclass(frozen=True)
class LogitechG510(KeyboardInterface):
    deviceName = "Logitech G510"

    usbVendor = 0x046d
    usbProduct = 0xc22d
    usbConfiguration = 0
    usbInterface = (1, 0)
    usbEndpoint = 0

    numMacroKeys = 18
    numMemoryKeys = 3

    disableGKeysInterface = 1
    disableGKeysUseWrite = False

    events = LogitechG510EventInterface


@dataclass(frozen=True)
class LogitechG815(KeyboardInterface):
    deviceName = "Logitech G815"

    usbVendor = 0x046d
    usbProduct = 0xc33f
    usbConfiguration = 0
    usbInterface = (1, 0)
    usbEndpoint = 0

    numMacroKeys = 5
    numMemoryKeys = 3

    disableGKeysInterface = 1

    events = LogitechG815EventInterface


@dataclass(frozen=True)
class LogitechG915(LogitechG815):
    deviceName = "Logitech G915 (wired)"
    usbProduct = 0xc33e
    events = LogitechG915EventInterface


SUPPORTED_DEVICES = [
    LogitechG915,
    LogitechG910OrionSpectrum,
    LogitechG910OrionSpark,
    LogitechG815,
    LogitechG710p,
    LogitechG510
]
